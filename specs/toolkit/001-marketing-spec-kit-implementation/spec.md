<!--
Toolkit Specification Report
============================
Toolkit: 001-marketing-spec-kit-implementation v1.0.0 | Updated Dependencies
Date: 2025-11-15 (Updated: 2025-11-17)

Summary:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Language: Python 3.9+
Components: 4 (Parser, Validator, CLI, Slash Commands)
Domain Dependencies: 1 (domain/001-marketing-operations-spec v0.3.0)
Status: Draft

Impact:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Created: specs/toolkit/001-marketing-spec-kit-implementation/spec.md
Dependencies: domain/001-marketing-operations-spec v0.3.0 (9 entities, 45 rules, SDM workflow)
Related Files: README.md, AGENTS.md

Constitution Compliance: ✅ Entity-First, Spec-First, AI-Agent Friendly

Dependency Update (2025-11-17):
- Domain Spec: v1.0.0 → v0.3.0 (semantic versioning correction)
- Entities: 7 → 9 (added MarketingPlan, Analytics)
- Validation Rules: 25 → 45 (+20 new rules)
- Workflow: Added Specification Usage Workflow (SDM 10 steps)
- State Machines: Added 3 entity lifecycles

Next Steps:
1. Plan architecture (/metaspec.sdd.plan)
2. Break down tasks (/metaspec.sdd.tasks)
3. Implement components (/metaspec.sdd.implement)

Generated by: /metaspec.sdd.specify (MetaSpec v0.6.2)
Updated by: Manual dependency sync (MetaSpec v0.8.1 guidance)
-->

---
toolkit_id: "001-marketing-spec-kit-implementation"
toolkit_version: "1.0.0"
toolkit_status: "draft"
primary_language: "python"
generated_by: "MetaSpec v0.6.2"
generated_date: "2025-11-15"
updated_date: "2025-11-17"
updated_reason: "Domain spec dependency update (v1.0.0 → v0.3.0)"
---

# Marketing-Spec-Kit Toolkit Implementation

**Version**: 1.0.0  
**Status**: Draft  
**Created**: 2025-11-15  
**Primary Language**: Python 3.9+

---

## Dependencies

### Domain Specifications

**Depends on**: `specs/domain/001-marketing-operations-spec/` (v0.3.0)

**Dependency Rationale**:

This toolkit implements support for the Marketing Operations Specification, which defines:
- **9 Core Entities**: Project, Product, MarketingPlan, Campaign, Channel, Tool, ContentTemplate, Milestone, Analytics
- **Specification Usage Workflow (SDM)**: 10-step workflow for creating marketing specifications (constitution → discover → clarify → strategy → checklist → tasks → analyze → create → review → optimize)
- **Entity State Machines**: 3 entity lifecycles (MarketingPlan, Campaign, Milestone)
- **45 Validation Rules**: Comprehensive coverage across all entity types and their relationships
- **Entity Relationships**: Documented dependencies and referential integrity constraints

**How this toolkit depends on the specification**:
- **Parser** parses all 9 entity types defined in the specification
- **Validator** enforces all 45 validation rules from the specification
- **CLI** provides user-facing commands (`init`, `validate`) based on specification structure
- **Slash Commands** implement the 10-step Specification Usage Workflow defined in the specification
- **Workflow Engine** follows the SDM workflow pattern for spec creation and validation

**Key Workflow Dependency**:
- Domain spec defines **HOW to create** marketing specifications (SDM workflow)
- Toolkit provides **commands to execute** each workflow step
- Each slash command (e.g., `/marketspec.discover`) maps 1:1 to a workflow step
- Command inputs/outputs align with workflow step requirements

**Important**: 
- Changes to specification entities require updates to Parser models
- New validation rules in specification must be implemented in Validator
- Workflow changes in specification should be reflected in slash commands
- This is a Spec-Driven toolkit - specification is the source of truth

---

## Overview

### Purpose

**marketing-spec-kit** is a Python toolkit that enables users to:
1. Define marketing operations specifications in YAML/JSON format
2. Validate specifications against the Marketing Operations Specification
3. Use AI agents to access specifications and generate marketing content
4. Initialize new marketing project structures

### Target Specification

Implements support for: `domain/001-marketing-operations-spec` v0.3.0

### Primary Use Cases

1. **Create Marketing Specifications**
   - User runs: `marketing_spec_kit init metaspec-marketing.yaml`
   - Toolkit creates: Project skeleton with entity templates
   - User fills: Marketing project details (Project, Products, Campaigns, etc.)

2. **Validate Marketing Specifications**
   - User runs: `marketing_spec_kit validate metaspec-marketing.yaml`
   - Toolkit checks: All 25 validation rules
   - Output: Error/warning reports with actionable fixes

3. **AI-Driven Content Generation** (Primary Use Case)
   - AI agent calls: `/marketing.project` → Gets MetaSpec brand identity
   - AI agent calls: `/marketing.campaign metaspec-v060-launch` → Gets campaign goals
   - AI agent calls: `/marketing.generate.post` → Generates Twitter post
   - AI agent validates: Content complies with brand guidelines

### Example Usage

```bash
# 1. Initialize new marketing specification
marketing_spec_kit init metaspec-marketing.yaml

# 2. Edit specification (define Project, Products, Campaigns)
vim metaspec-marketing.yaml

# 3. Validate specification
marketing_spec_kit validate metaspec-marketing.yaml
# Output: ✅ All validation rules passed (25/25)

# 4. AI agent uses slash commands (in AI chat)
/marketing.project metaspec
# → Returns project brand identity for content generation

/marketing.generate.post campaign_id=metaspec-v060-launch channel_id=twitter
# → Generates spec-compliant Twitter post
```

---

## Implementation

### Language & Ecosystem

**Primary Language**: Python 3.9+

**Rationale**:
- **Target user community**: Developers, open source maintainers, product teams (Python ecosystem)
- **Ecosystem fit**: Rich libraries for YAML/JSON parsing (pyyaml, pydantic), CLI (typer), validation (jsonschema)
- **Performance considerations**: Validation and parsing are I/O-bound, Python is sufficient
- **Deployment needs**: pip installable, cross-platform, minimal dependencies

**Key Dependencies**:
- **pydantic** (v2.0+): Data validation, schema definition, type safety
- **typer** (v0.9+): Modern CLI framework, automatic help generation
- **pyyaml** (v6.0+): YAML parsing and serialization
- **jsonschema** (v4.0+): JSON Schema validation support
- **rich** (v13.0+): Terminal formatting, progress bars, tables

### Architecture

**Structure**: Modular

**Core Components** (MVP):
- ✅ **Parser** - Parse YAML/JSON marketing specifications into Python objects
- ✅ **Validator** - Enforce 25 validation rules from domain specification
- ✅ **CLI** - User commands (`info`, `init`, `validate`)
- ✅ **Slash Commands** - 13 AI Agent operations (to be implemented)

**Future Enhancements** (Post-MVP):
- ⏭️ **Generator** - Generate marketing content templates
- ⏭️ **SDK** - Programmatic API for other tools

**Extensibility**:
- **Custom validators**: Users can add project-specific validation rules via plugins
- **Template system**: Users can provide custom entity templates
- **Hook system**: Pre/post validation hooks for custom logic

**File Structure** (Preliminary):
```
src/
  marketing_spec_kit/
    __init__.py           # Package initialization
    models.py             # Pydantic models for 7 entities
    parser.py             # YAML/JSON parser
    validator.py          # 25 validation rules implementation
    cli.py                # CLI entry point (init, validate)
    exceptions.py         # Custom exceptions (13 error codes)
    templates/            # Entity templates for init command
      project_template.yaml
      campaign_template.yaml
```

Note: Actual structure will be refined in `/metaspec.sdd.plan`

---

## Components

### Component 1: Parser

#### Purpose
Parse user marketing specifications from YAML/JSON into validated Python objects.

#### Input Formats
- **YAML** (primary): `metaspec-marketing.yaml`
- **JSON** (alternative): `metaspec-marketing.json`
- **Python dict** (programmatic): For testing and SDK usage

#### Output Format
- **Validated Python object**: `MarketingSpec` class containing all entities
- **Parsing errors**: Clear error messages with line numbers and fix suggestions

#### Parsing Steps
1. **Load file**: Read YAML/JSON from file system
2. **Validate schema structure**: Check for required top-level keys
3. **Parse entities**: Transform to Pydantic models (Project, Product, Campaign, etc.)
4. **Resolve references**: Link entities by IDs (e.g., Campaign → Product IDs)
5. **Return parsed object or errors**: `MarketingSpec` or `ParseError`

#### Entity Models (From Specification)

Based on `domain/001-marketing-operations-spec`, parse these 7 entities:

1. **Project**: Brand identity, voice, value propositions
   - Required fields: name, tagline, brand_voice, website, target_audience, value_propositions
   - Optional fields: logo_url, social_handles

2. **Product**: Features, positioning, target audience
   - Required fields: id, name, description, project_id, target_audience, key_features
   - Optional fields: positioning, launch_date

3. **Campaign**: Marketing activities, goals, budget, timeline
   - Required fields: id, name, goal, project_id, target_audience, budget, start_date, end_date, channels, status
   - Optional fields: product_ids, kpis

4. **Channel**: Distribution platforms (Twitter, Reddit, Email, Blog)
   - Required fields: id, name, type, platform, content_types
   - Optional fields: audiences, constraints, tool_id, config

5. **Tool**: MCP server or REST API integrations
   - Required fields: id, name, type, capabilities, status
   - Conditional fields: mcp_config (if type=mcp), api_config (if type=rest_api)
   - Optional fields: channel_ids

6. **ContentTemplate**: Brand guidelines, style rules, tone
   - Required fields: id, name, type, tone, style_guidelines, project_id
   - Optional fields: constraints, examples

7. **Milestone**: Release events, timeline markers
   - Required fields: id, name, type, date, project_id, status
   - Optional fields: description, product_ids, campaign_ids

#### Error Handling

**Error Types**:
- `ParseError`: Invalid YAML/JSON syntax (file format issues)
- `SchemaError`: Missing required fields (entity structure violations)
- `TypeError`: Incorrect field types (e.g., string instead of number)
- `ReferenceError`: Invalid entity references (e.g., Campaign references non-existent Product)

**Error Messages Format**:
```
MKT-VAL-001: Missing Required Field
Line 15: project.name is required
Fix: Add "name: YourProjectName" to the project section
```

#### API Design

```python
from marketing_spec_kit.parser import parse_spec

# Parse from file
spec = parse_spec("metaspec-marketing.yaml")
# Returns: MarketingSpec object

# Parse from string (for testing)
spec = parse_spec(yaml_string, format="yaml")

# Parse from dict (programmatic)
spec = parse_spec(spec_dict, format="dict")

# Error handling
try:
    spec = parse_spec("invalid.yaml")
except ParseError as e:
    print(f"Parse failed: {e.message}")
    print(f"Error code: {e.code}")  # MKT-VAL-001
    print(f"Fix: {e.fix}")
```

---

### Component 2: Validator

#### Purpose
Validate marketing specifications against the 25 validation rules defined in `domain/001-marketing-operations-spec`.

#### Validation Rules (Reference Specification)

**From domain/001-marketing-operations-spec**:

**Project Rules (VR-P01 to VR-P06)**: 6 rules
- P01: name must be unique within workspace
- P02: tagline ≤ 100 characters
- P03: website must be valid HTTPS URL
- P04: target_audience ≥ 1 item
- P05: brand_voice must match enum
- P06: social_handles must use valid format

**Product Rules (VR-PR01 to VR-PR05)**: 5 rules
- PR01: id must be unique within Project
- PR02: project_id must reference existing Project
- PR03: description ≤ 500 characters
- PR04: key_features should have 3-5 items (warning)
- PR05: launch_date validation

**Campaign Rules (VR-C01 to VR-C09)**: 9 rules
- C01: id unique, C02: valid project reference, C03: valid product references
- C04: budget > 0, C05: start_date < end_date
- C06: future start date (warning), C07: valid channel references
- C08: CTR range 0-1, C09: ROAS ≥ 3 (warning)

**Channel Rules (VR-CH01 to VR-CH06)**: 6 rules  
**Tool Rules (VR-T01 to VR-T06)**: 6 rules  
**ContentTemplate Rules (VR-CT01 to VR-CT05)**: 5 rules  
**Milestone Rules (VR-M01 to VR-M05)**: 5 rules

**Total**: 25 validation rules

#### Validation Levels

- **Error** (❌): Violations that prevent usage (must fix)
- **Warning** (⚠️): Issues that should be fixed (recommended)
- **Info** (ℹ️): Suggestions for improvement (optional)

#### Validation Output

```python
ValidationResult(
    valid: bool,                      # Overall pass/fail
    errors: List[ValidationError],    # Blocking issues
    warnings: List[ValidationWarning], # Recommended fixes
    info: List[ValidationInfo],       # Suggestions
    rules_checked: int,               # Total rules checked (25)
    rules_passed: int                 # Rules passed
)

ValidationError(
    code: str,              # MKT-VAL-001, MKT-REF-001, etc.
    message: str,           # Human-readable error
    entity: str,            # Entity ID (e.g., "metaspec-v060-launch")
    field: str,             # Field name (e.g., "budget")
    location: str,          # YAML path (e.g., "campaign.budget")
    fix: str                # Suggested fix
)
```

#### Error Messages (From Specification)

Implement 13 error codes from `domain/001-marketing-operations-spec`:

| Code | Category | Description |
|------|----------|-------------|
| MKT-VAL-001 | Validation | Missing Required Field |
| MKT-VAL-002 | Validation | Invalid Field Type |
| MKT-VAL-003 | Validation | Constraint Violation |
| MKT-REF-001 | Reference | Entity Not Found |
| MKT-REF-002 | Reference | Invalid Reference |
| MKT-API-001 | Tool/API | Tool Unavailable |
| MKT-API-002 | Tool/API | Rate Limit Exceeded |
| MKT-API-003 | Tool/API | Authentication Failed |
| MKT-GEN-001 | Generation | Content Generation Failed |
| MKT-GEN-002 | Generation | Template Not Found |
| MKT-GEN-003 | Generation | Content Constraint Violation |
| MKT-EXE-001 | Execution | Execution Failed |
| MKT-EXE-002 | Execution | Content Validation Failed |

**Note**: Parser/Validator implement VAL and REF codes. API/GEN/EXE codes are for AI agent operations.

#### API Design

```python
from marketing_spec_kit.validator import validate_spec

# Validate parsed spec
result = validate_spec(spec)

if not result.valid:
    print(f"❌ Validation failed ({result.rules_passed}/{result.rules_checked} rules passed)")
    for error in result.errors:
        print(f"{error.code}: {error.message}")
        print(f"  Location: {error.location}")
        print(f"  Fix: {error.fix}")
else:
    print(f"✅ All validation rules passed ({result.rules_checked}/{result.rules_checked})")

# Show warnings even if validation passes
for warning in result.warnings:
    print(f"⚠️  {warning.message}")
```

---

### Component 3: CLI Commands

#### Overview

Marketing-Spec-Kit CLI provides commands for developers to create and validate marketing specifications.

#### Toolkit Type Classification

Marketing-Spec-Kit is:
- ✅ **Generator/Scaffolder** - Creates project structures (`init`)
- ✅ **Validator** - Validates against specification schemas (`validate`)
- ⏭️ **Query/Reference Tool** - (Future: `show`, `list`)

#### Command Design Philosophy

Following **spec-kit golden reference**:
- Keep commands minimal (2-3 commands for MVP)
- Use parameters for variations, not new commands
- Prioritize industry standard names (`init`, `validate`)
- Unified commands over specialized variants

#### CLI Commands (MVP: 2 commands)

##### Command 1: `info`

**Purpose**: Show toolkit information (already implemented)

**Usage**:
```bash
marketing_spec_kit info
```

**Output**:
```
Speckit: marketing_spec_kit
Version: 0.1.0
Domain: Marketing Operations

Use /metaspec.sdd.implement to add CLI commands
See AGENTS.md for AI-assisted development guide
```

**Implementation**: Already exists in `src/marketing_spec_kit/cli.py`

---

##### Command 2: `init`

**Purpose**: Initialize new marketing specification with templates

**Usage**:
```bash
marketing_spec_kit init <filename> [OPTIONS]
```

**Arguments**:
- `filename` (required): Output file name (e.g., `metaspec-marketing.yaml`)

**Options**:
- `--template TEMPLATE`: Template to use (default: `default`, options: `minimal`, `full`)
- `--format FORMAT`: Output format (default: `yaml`, options: `json`)
- `--overwrite`: Overwrite existing file if present

**Example**:
```bash
# Create minimal marketing spec
marketing_spec_kit init metaspec-marketing.yaml

# Create full template with all entity examples
marketing_spec_kit init metaspec-marketing.yaml --template full

# Create JSON format
marketing_spec_kit init metaspec-marketing.json --format json
```

**Output**:
- Creates YAML/JSON file with entity templates
- Prints next steps (edit file, validate)

**Implementation Notes**:
- Uses templates from `src/marketing_spec_kit/templates/`
- Renders Jinja2 templates with placeholder data
- Exit codes: 0 (success), 1 (file exists), 2 (error)

---

##### Command 3: `validate`

**Purpose**: Validate marketing specification against all rules

**Usage**:
```bash
marketing_spec_kit validate <filename> [OPTIONS]
```

**Arguments**:
- `filename` (required): Specification file to validate

**Options**:
- `--strict`: Treat warnings as errors
- `--format FORMAT`: Output format (default: `text`, options: `json`, `table`)
- `--quiet`: Only show errors (suppress warnings/info)

**Example**:
```bash
# Validate specification
marketing_spec_kit validate metaspec-marketing.yaml
# Output:
# ✅ All validation rules passed (25/25)
# ⚠️  Warning: Campaign C04 has low budget ($100)

# Strict mode (warnings fail validation)
marketing_spec_kit validate metaspec-marketing.yaml --strict
# Exit code: 1 (warnings treated as errors)

# JSON output (for CI/CD)
marketing_spec_kit validate metaspec-marketing.yaml --format json
# {"valid": true, "errors": [], "warnings": [...]}
```

**Output Formats**:
- **text** (default): Human-readable, colored, with fix suggestions
- **json**: Machine-readable for automation
- **table**: Rich table format with rule-by-rule status

**Implementation Notes**:
- Calls Parser → Validator pipeline
- Shows progress bar for large files
- Exit codes: 0 (pass), 1 (errors), 2 (file not found)

---

#### Future Commands (Post-MVP)

##### Command 4: `show` (Planned)

**Purpose**: Display specification details

**Usage**:
```bash
marketing_spec_kit show <entity_type> [entity_id]
```

**Examples**:
```bash
marketing_spec_kit show project
marketing_spec_kit show campaign metaspec-v060-launch
marketing_spec_kit show channels
```

---

### Component 4: Slash Commands

#### Toolkit Type Declaration

**Type**: B - Workflow-Guidance Toolkit ⭐ (Speckit Standard)

**Purpose**: Guide users to create and manage marketing specifications

**Pattern**: `/marketspec.{action}` - Workflow commands (NOT entity operations)

**Rationale**:
- This toolkit helps users **create marketing specifications** (Type B)
- NOT for accessing existing data (Type A)
- Follows spec-kit and MetaSpec pattern
- Reference: MetaSpec itself uses workflow commands only

**Key Insight**:
- Domain spec's entities = specification structure (WHAT to specify)
- Toolkit's commands = workflow actions (HOW to create specs)
- We do NOT provide entity CRUD operations (users edit YAML directly)

#### Overview

Slash Commands are **workflow guidance tools** for AI agents to:
1. Guide end-to-end marketing specification creation
2. Ensure quality through validation checkpoints
3. Support continuous improvement through feedback loops

**What they are**: Workflow step commands based on MetaSpec SDD pattern  
**Where they go**: `templates/sdm/commands/` directory  
**How AI uses them**: Via `/marketspec.*` prefix in AI chat  
**Core purpose**: Guide users from discovery to optimization in marketing planning

#### Command Pattern

**Based on**: MetaSpec SDD (8-step workflow)  
**Adapted for**: Marketing domain  
**Extensions**: 2 additional commands for post-execution optimization

#### Workflow Command Inventory

Based on MetaSpec SDD pattern, adapted for marketing domain:

##### Core Workflow Commands (8) - Planning Phase

```
Core Flow:      constitution → discover → strategy → tasks → create
Quality Gates:             ↓ clarify ↓     ↓ checklist     ↓ analyze
                           (before)      (after)         (before)
```

**Execution Order**: `constitution → discover → clarify → strategy → checklist → tasks → analyze → create`

1. **`/marketspec.constitution`** - Define marketing execution principles
   - **Type**: Core (Optional)
   - **Input**: User's values, constraints, team context
   - **Output**: `memory/marketing-constitution.md`
   - **Purpose**: Establish guiding principles for all marketing activities
   - **Based on**: `metaspec.sdd.constitution`

2. **`/marketspec.discover`** - Discover marketing needs and objectives
   - **Type**: Core (Required)
   - **Input**: Business goals, target audience, market context
   - **Output**: `specs/discovery/[name]-discovery.md`
   - **Purpose**: Define WHAT needs to be achieved
   - **Based on**: `metaspec.sdd.specify` (renamed for marketing clarity)

3. **`/marketspec.clarify`** - Clarify ambiguities and requirements
   - **Type**: Quality Gate (Recommended, BEFORE strategy)
   - **Input**: `discovery.md` + constitution
   - **Output**: `specs/clarifications/[name]-clarification.md`
   - **Purpose**: Resolve unclear objectives before planning
   - **Based on**: `metaspec.sdd.clarify`

4. **`/marketspec.strategy`** - Plan marketing strategy and approach
   - **Type**: Core (Required)
   - **Input**: `discovery.md` + `clarification.md`
   - **Output**: `specs/strategy/[name]-strategy.md`
   - **Purpose**: Define HOW to achieve objectives
   - **Based on**: `metaspec.sdd.plan` (renamed for marketing clarity)

5. **`/marketspec.checklist`** - Validate strategy completeness
   - **Type**: Quality Gate (Recommended, AFTER strategy)
   - **Input**: `strategy.md` + constitution
   - **Output**: `marketing-spec-checklist.md`
   - **Purpose**: Ensure all requirements are covered
   - **Based on**: `metaspec.sdd.checklist`

6. **`/marketspec.tasks`** - Break down strategy into actionable tasks
   - **Type**: Core (Required)
   - **Input**: `strategy.md` + `checklist.md`
   - **Output**: `specs/tasks/[name]-tasks.md`
   - **Purpose**: Define concrete execution steps
   - **Based on**: `metaspec.sdd.tasks`

7. **`/marketspec.analyze`** - Check consistency across all documents
   - **Type**: Quality Gate (Recommended, BEFORE create)
   - **Input**: `discovery.md` + `strategy.md` + `tasks.md`
   - **Output**: `consistency-report.md`
   - **Purpose**: Ensure alignment before generating final spec
   - **Based on**: `metaspec.sdd.analyze`

8. **`/marketspec.create`** - Generate marketing-spec.yaml
   - **Type**: Core (Required)
   - **Input**: All previous documents
   - **Output**: `marketing-spec.yaml`
   - **Purpose**: Create final executable specification
   - **Based on**: `metaspec.sdd.implement` (renamed for clarity)

##### Extension Commands (2) - Post-Execution Phase

```
... → create → [Execute Campaign] → review → optimize
                                      ↓         ↓
                                 分析效果   优化建议
```

**Closed-Loop Marketing**: Plan → Execute → Review → Optimize → Next Plan

9. **`/marketspec.review`** - Analyze actual campaign performance
   - **Type**: Extension (Optional)
   - **Input**: `marketing-spec.yaml` + actual execution data
   - **Output**: `campaign-review.md`
   - **Purpose**: Compare planned vs actual results
   - **Original**: Marketing-specific extension

10. **`/marketspec.optimize`** - Generate optimization recommendations
    - **Type**: Extension (Optional)
    - **Input**: `campaign-review.md` + `marketing-spec.yaml`
    - **Output**: `optimization-recommendations.md`
    - **Purpose**: Provide insights for next campaign
    - **Original**: Marketing-specific extension

#### Command Classification

All 10 commands are **Workflow Guidance Commands**:
- Guide users through structured planning process
- Produce intermediate documents (discovery, strategy, tasks, etc.)
- Generate final `marketing-spec.yaml` specification
- Support quality gates and consistency checks

**Why workflow commands, not entity operations?**
- Users can directly edit `marketing-spec.yaml` (no CRUD commands needed)
- AI can read/write YAML files directly
- Workflow commands provide structure and quality assurance
- Follows spec-kit and MetaSpec pattern

#### Frontmatter Fields (All Commands)

All 10 slash commands will include:

```yaml
---
description: Brief description of workflow step
argument-hint: [optional-args]
allowed-tools: FileEdit(specs/*, memory/*), Bash(git:*)
model: claude-3-5-sonnet-20241022
---
```

#### Command Template Structure (Example: `/marketspec.discover`)

```markdown
---
description: Discover marketing needs and objectives
argument-hint: [campaign-name]
allowed-tools: FileEdit(specs/discovery/*, memory/*), Bash(git:*)
model: claude-3-5-sonnet-20241022
---

# /marketspec.discover

## User Input

\```text
$ARGUMENTS
\```

You **MUST** consider the user input before proceeding (if not empty).

## Purpose

Guide users to discover and define marketing objectives, target audience, and success criteria. This is the first step in creating a marketing specification.

## Workflow Context

**Position**: Step 2 of 10 in SDM workflow  
**Previous**: `/marketspec.constitution` (optional)  
**Next**: `/marketspec.clarify` (recommended QG)

## Process

1. **Understand Business Context**
   - Ask about business goals
   - Identify target outcomes
   - Understand constraints

2. **Define Marketing Objectives**
   - What are we trying to achieve?
   - Who is the target audience?
   - What's the timeline?

3. **Identify Success Metrics**
   - How will we measure success?
   - What are the KPIs?
   - What's the expected impact?

4. **Generate Discovery Document**
   - Create: `specs/discovery/[name]-discovery.md`
   - Include: Objectives, audience, metrics, constraints
   - Format: Structured markdown

## Output Template

\```markdown
# Marketing Discovery: [Campaign Name]

## Business Context
- Goals: ...
- Timeline: ...
- Budget: ...

## Target Audience
- Primary: ...
- Secondary: ...
- Personas: ...

## Objectives
1. ...
2. ...

## Success Metrics
- KPI 1: ...
- KPI 2: ...

## Constraints
- ...
\```

## See Also

- `/marketspec.constitution` - Define principles first (optional)
- `/marketspec.clarify` - Clarify ambiguities next (QG)
- `/marketspec.strategy` - Plan strategy after discovery
```

#### Command Inventory

**Total Slash Commands**: 10

**Core Workflow Commands** (8):
- [ ] `/marketspec.constitution.md` - Define principles (Optional)
- [ ] `/marketspec.discover.md` - Discover needs (Required)
- [ ] `/marketspec.clarify.md` - Clarify ambiguities (QG, Recommended)
- [ ] `/marketspec.strategy.md` - Plan strategy (Required)
- [ ] `/marketspec.checklist.md` - Validate completeness (QG, Recommended)
- [ ] `/marketspec.tasks.md` - Break down work (Required)
- [ ] `/marketspec.analyze.md` - Check consistency (QG, Recommended)
- [ ] `/marketspec.create.md` - Generate YAML (Required)

**Extension Commands** (2):
- [ ] `/marketspec.review.md` - Analyze performance (Optional)
- [ ] `/marketspec.optimize.md` - Generate recommendations (Optional)

**Priority**:
- **P0 (Critical for MVP)**: Core required commands (5): discover, strategy, tasks, create + constitution
- **P1 (Important)**: Quality gates (3): clarify, checklist, analyze
- **P2 (Nice to have)**: Extensions (2): review, optimize

**Implementation Strategy**:
1. Commands already exist in `templates/sdm/commands/marketspec.*.md`
2. Based on MetaSpec SDD pattern with marketing adaptations
3. Each command follows 13-part structure
4. Workflow ensures quality through checkpoints
5. Supports closed-loop marketing (plan → execute → review → optimize)

---

## Architecture

### Module Structure

```
marketing_spec_kit/
├── __init__.py                # Package initialization, version info
├── models.py                  # Pydantic models for 7 entities
├── parser.py                  # YAML/JSON parser
├── validator.py               # 25 validation rules implementation
├── cli.py                     # CLI entry point (typer app)
├── exceptions.py              # Custom exceptions (13 error codes)
├── templates/                 # Entity templates for init command
│   ├── default.yaml           # Default template (all entities)
│   ├── minimal.yaml           # Minimal template (Project only)
│   └── full.yaml              # Full template with examples
└── utils.py                   # Helper functions
```

### Data Flow

```
User Input (YAML/JSON)
    ↓
  Parser  ───→ MarketingSpec object (7 entities)
    ↓
Validator ───→ ValidationResult (25 rules checked)
    ↓
CLI Output  ───→ User feedback (errors/warnings/success)

AI Agent Input (Slash Command)
    ↓
Slash Command ───→ Read specification file
    ↓
Parse Entity ───→ Extract specific entity data
    ↓
Return to AI ───→ AI generates content using entity knowledge
```

### Key Classes

```python
# models.py
class MarketingSpec:
    """Root specification object containing all entities"""
    project: Project
    products: List[Product]
    campaigns: List[Campaign]
    channels: List[Channel]
    tools: List[Tool]
    content_templates: List[ContentTemplate]
    milestones: List[Milestone]

class Project(BaseModel):
    """Project entity (from specification)"""
    name: str
    tagline: str = Field(..., max_length=100)
    brand_voice: BrandVoice  # Enum
    website: HttpUrl
    target_audience: List[str] = Field(..., min_items=1)
    value_propositions: List[str] = Field(..., min_items=1)
    logo_url: Optional[HttpUrl]
    social_handles: Optional[Dict[str, str]]

# (Similar classes for Product, Campaign, Channel, Tool, ContentTemplate, Milestone)

# parser.py
class MarketingSpecParser:
    """Parse YAML/JSON to MarketingSpec"""
    def parse(self, source: Union[str, Path, dict], format: str = "yaml") -> MarketingSpec:
        ...

# validator.py
class MarketingSpecValidator:
    """Validate MarketingSpec against 25 rules"""
    def validate(self, spec: MarketingSpec) -> ValidationResult:
        ...

# exceptions.py
class MarketingSpecError(Exception):
    """Base exception"""
    code: str
    message: str
    fix: str

class ParseError(MarketingSpecError):
    """MKT-VAL-001, MKT-VAL-002"""
    ...

class ValidationError(MarketingSpecError):
    """MKT-VAL-003, MKT-REF-001, MKT-REF-002"""
    ...
```

---

## Technical Requirements

### Language
- Python 3.9+ (for Union type hints, dataclasses enhancements)

### Core Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| pydantic | ≥2.0.0 | Data validation, schema definition, type safety |
| typer | ≥0.9.0 | CLI framework with automatic help generation |
| pyyaml | ≥6.0 | YAML parsing and serialization |
| jsonschema | ≥4.0.0 | JSON Schema validation support |
| rich | ≥13.0.0 | Terminal formatting, tables, progress bars |

### Development Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| pytest | ≥7.4.0 | Testing framework |
| pytest-cov | ≥4.1.0 | Code coverage reporting |
| mypy | ≥1.0.0 | Static type checking |
| ruff | ≥0.1.0 | Linting and formatting (replaces black + flake8) |
| pre-commit | ≥3.0.0 | Git hooks for quality checks |

### Optional Dependencies

- **MCP Client** (if we implement MCP tool calling): `mcp-client` package
- **REST API Client** (if we implement API calling): `httpx` package

---

## Validation Strategy

### Unit Tests

**Target Coverage**: 80%+

**Test Structure**:
```
tests/
├── unit/
│   ├── test_parser.py           # Parser component tests
│   ├── test_validator.py        # Validator rule tests
│   ├── test_models.py           # Pydantic model tests
│   ├── test_cli.py              # CLI command tests
│   └── test_exceptions.py       # Exception handling tests
├── integration/
│   ├── test_end_to_end.py       # Full workflow tests
│   └── test_cli_integration.py  # CLI integration tests
└── fixtures/
    ├── valid_specs/
    │   ├── minimal.yaml          # Minimal valid spec
    │   ├── full.yaml             # Complete valid spec
    │   └── metaspec_example.yaml # Real-world example
    └── invalid_specs/
        ├── missing_project.yaml  # VR-P01 test
        ├── invalid_budget.yaml   # VR-C04 test
        └── ...                   # One fixture per validation rule
```

### Test Categories

#### 1. Parser Tests (`test_parser.py`)

- ✅ Valid YAML parsing (minimal, full, nested entities)
- ✅ Valid JSON parsing
- ✅ Invalid syntax handling (malformed YAML, JSON)
- ✅ Missing required fields detection
- ✅ Type coercion (string → number, string → date)
- ✅ Reference resolution (Campaign → Product IDs)
- ✅ Edge cases (empty files, large files >1MB, Unicode characters)

#### 2. Validator Tests (`test_validator.py`)

**One test per validation rule (25 tests)**:

- ✅ VR-P01 to VR-P06: Project validation (6 tests)
- ✅ VR-PR01 to VR-PR05: Product validation (5 tests)
- ✅ VR-C01 to VR-C09: Campaign validation (9 tests)
- ✅ VR-CH01 to VR-CH06: Channel validation (6 tests)
- ✅ VR-T01 to VR-T06: Tool validation (6 tests)
- ✅ VR-CT01 to VR-CT05: ContentTemplate validation (5 tests)
- ✅ VR-M01 to VR-M05: Milestone validation (5 tests)

**Additional tests**:
- ✅ Multiple errors handling (collect all errors, don't stop at first)
- ✅ Warning vs error distinction
- ✅ Error message quality (clear, actionable, with fix suggestions)

#### 3. CLI Tests (`test_cli.py`)

- ✅ `info` command (output check)
- ✅ `init` command:
  - Creates file successfully
  - Handles existing file (error or --overwrite)
  - Template variations (minimal, default, full)
  - Format variations (YAML, JSON)
- ✅ `validate` command:
  - Valid spec (exit code 0)
  - Invalid spec (exit code 1, error messages)
  - Strict mode (warnings as errors)
  - Output formats (text, json, table)
  - Quiet mode (only errors)
- ✅ Help messages (--help for each command)
- ✅ Error handling (file not found, invalid format)

#### 4. Integration Tests (`test_end_to_end.py`)

- ✅ Full workflow: init → edit → validate
- ✅ AI agent workflow: Slash command reads spec → validates structure
- ✅ Real-world scenario: MetaSpec marketing spec validation

### Validation Data

**Location**: `tests/fixtures/`

**Valid Specs**:
- `minimal.yaml`: Bare minimum (Project only)
- `full.yaml`: All entities with all optional fields
- `metaspec_example.yaml`: Real MetaSpec marketing spec

**Invalid Specs** (one per validation rule):
- `vr_p01_duplicate_name.yaml`: Duplicate project names
- `vr_p02_long_tagline.yaml`: Tagline > 100 chars
- `vr_c04_zero_budget.yaml`: Budget = 0
- ... (25 invalid specs total)

### CI/CD Integration

**GitHub Actions** (`.github/workflows/test.yml`):
```yaml
name: Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - run: pip install -e ".[dev]"
      - run: pytest --cov=marketing_spec_kit --cov-report=term
      - run: mypy src/
      - run: ruff check src/
```

---

## Success Criteria

### MVP Features

- ✅ **Parser**: Parse all 7 entity types from YAML/JSON
- ✅ **Validator**: Implement all 25 validation rules
- ✅ **CLI**: `info`, `init`, `validate` commands working
- ✅ **Slash Commands**: 13 AI agent operations implemented
- ✅ **Error Handling**: 13 error codes with clear messages
- ✅ **Templates**: Default, minimal, full templates

### Quality Metrics

- ✅ All tests pass (unit + integration)
- ✅ 80%+ code coverage
- ✅ No critical linting errors (ruff check)
- ✅ Type hints complete (mypy passes with no errors)
- ✅ All 25 validation rules have dedicated tests

### Documentation

- ✅ README with quickstart guide
- ✅ AGENTS.md with AI slash commands documentation
- ✅ CLI help messages complete (--help for all commands)
- ✅ Example specifications (MetaSpec marketing example)
- ✅ API documentation (docstrings for all public functions)

### User Experience

- ✅ Clear error messages with fix suggestions
- ✅ Fast execution (< 1s for typical specs, < 5s for large specs)
- ✅ Good CLI UX (rich formatting, progress bars for large files)
- ✅ AI-friendly slash commands (embed specification knowledge)

### Performance Targets

- Parse time: < 100ms for typical spec (< 10 entities)
- Validate time: < 200ms for all 25 rules
- CLI startup time: < 500ms
- Memory usage: < 50MB for typical spec

---

## Implementation Plan

See `plan.md` (to be created via `/metaspec.sdd.plan`)

---

## Tasks

See `tasks.md` (to be created via `/metaspec.sdd.tasks`)

---

## Next Steps

1. ✅ **This specification is complete** - Ready for planning
2. ⏭️ **Run `/metaspec.sdd.plan`** - Create detailed architecture plan
3. ⏭️ **Run `/metaspec.sdd.tasks`** - Break down implementation tasks
4. ⏭️ **Run `/metaspec.sdd.implement`** - Start building components

---

**Generated by**: /metaspec.sdd.specify (MetaSpec v0.6.2)  
**Framework**: MetaSpec  
**Toolkit**: marketing-spec-kit  
**Domain**: Marketing Operations

